---
/**
 * AgentCMS ‚Äî BlogPostCard
 * Individual post card for use in blog listings.
 * Fully styleable via CSS custom properties and data attributes.
 */

interface Props {
  post: {
    slug: string;
    title: string;
    description: string;
    publishedAt: string;
    tags: string[];
    category?: string;
    author: string;
    authorType: "agent" | "human";
    featuredImage?: string;
    readingTime?: number;
  };
  basePath?: string;
  showImage?: boolean;
  showExcerpt?: boolean;
  showTags?: boolean;
  showAuthor?: boolean;
  headingLevel?: "h2" | "h3";
  class?: string;
}

const {
  post,
  basePath = "/blog",
  showImage = true,
  showExcerpt = true,
  showTags = true,
  showAuthor = true,
  headingLevel: Heading = "h2",
  class: className,
} = Astro.props;

const postUrl = `${basePath}/${post.slug}`;
const date = new Date(post.publishedAt).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<article data-acms-post-card class:list={[className]}>
  <a href={postUrl} data-acms-post-card-link>
    {showImage && post.featuredImage && (
      <div data-acms-post-card-image>
        <slot name="image">
          <img src={post.featuredImage} alt={post.title} loading="lazy" decoding="async" />
        </slot>
      </div>
    )}
    <div data-acms-post-card-body>
      {showTags && post.tags.length > 0 && (
        <div data-acms-post-card-tags>
          <span data-acms-tag-badge>{post.tags[0]}</span>
        </div>
      )}
      <Heading data-acms-post-card-title>{post.title}</Heading>
      {showExcerpt && (
        <p data-acms-post-card-excerpt>{post.description}</p>
      )}
      <div data-acms-post-card-meta>
        {showAuthor && (
          <span data-acms-post-card-author>
            <span data-acms-author-icon>{post.authorType === "agent" ? "ü§ñ" : "‚úçÔ∏è"}</span>
            {post.author}
          </span>
        )}
        <time datetime={post.publishedAt} data-acms-post-card-date>{date}</time>
        {post.readingTime && (
          <span data-acms-post-card-readtime>{post.readingTime} min read</span>
        )}
      </div>
    </div>
  </a>
</article>

<style>
  [data-acms-post-card] {
    container-type: inline-size;
  }
  [data-acms-post-card-link] {
    display: flex;
    flex-direction: column;
    height: 100%;
    text-decoration: none;
    color: inherit;
    overflow: hidden;
    transition: opacity 0.4s ease;
  }
  [data-acms-post-card-link]:hover {
    opacity: 0.7;
  }
  [data-acms-post-card-image] {
    aspect-ratio: 16 / 9;
    overflow: hidden;
  }
  [data-acms-post-card-image] img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  [data-acms-post-card-body] {
    padding: calc(var(--acms-space-unit, 1.25rem) * 1.25);
    display: flex;
    flex-direction: column;
    flex: 1;
    border-bottom: 1px solid var(--acms-color-border, #e5dfd6);
  }
  [data-acms-tag-badge] {
    font-family: var(--acms-font-mono, monospace);
    font-size: 0.7rem;
    font-weight: 300;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--acms-color-accent, #8b7355);
  }
  [data-acms-post-card-title] {
    font-family: var(--acms-font-heading, inherit);
    font-size: clamp(1.1rem, 2.5cqi, 1.5rem);
    font-weight: 300;
    line-height: 1.4;
    margin: 0.5rem 0;
    color: var(--acms-color-text, inherit);
  }
  [data-acms-post-card-excerpt] {
    font-family: var(--acms-font-body, inherit);
    font-size: 0.95rem;
    font-weight: 300;
    line-height: 1.7;
    color: var(--acms-color-text-muted, #9a9089);
    margin: 0 0 auto;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  [data-acms-post-card-meta] {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 1rem;
    font-size: 0.75rem;
    font-weight: 300;
    color: var(--acms-color-text-muted, #9a9089);
    font-family: var(--acms-font-mono, monospace);
  }
  [data-acms-post-card-author] {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  [data-acms-author-icon] {
    font-size: 0.9em;
  }
</style>
