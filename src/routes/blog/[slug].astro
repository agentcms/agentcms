---
/**
 * AgentCMS — Auto-mode Single Post Page
 * Injected at {basePath}/[slug] when mode is "auto".
 */
import BlogPostComponent from "@agentcms/core/components/BlogPost.astro";
import { getAgentCMSPost, getAgentCMSConfig } from "@agentcms/core";

const config = await getAgentCMSConfig();
const basePath = globalThis.__AGENTCMS_CONFIG__?.basePath || "/blog";

const { slug } = Astro.params;
const post = await getAgentCMSPost(slug!);

if (!post || post.status !== "published") {
  return new Response("Not found", { status: 404 });
}

const seoTitle = config?.seo?.titleTemplate
  ? config.seo.titleTemplate.replace("%s", post.title)
  : post.title;
---

<html lang={config?.language || "en"}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{seoTitle}</title>
    <meta name="description" content={post.description} />

    <!-- Open Graph -->
    <meta property="og:title" content={post.title} />
    <meta property="og:description" content={post.description} />
    <meta property="og:type" content="article" />
    <meta property="og:url" content={Astro.url.href} />
    {post.featuredImage && <meta property="og:image" content={post.featuredImage} />}
    <meta property="article:published_time" content={post.publishedAt} />
    {post.tags.map((tag) => <meta property="article:tag" content={tag} />)}

    <!-- Twitter -->
    <meta name="twitter:card" content={post.featuredImage ? "summary_large_image" : "summary"} />
    {config?.seo?.twitterHandle && (
      <meta name="twitter:site" content={config.seo.twitterHandle} />
    )}

    <link rel="alternate" type="application/rss+xml" title="Blog" href="/feed.xml" />
  </head>
  <body data-acms-page="blog-post">
    <nav data-acms-breadcrumb>
      <a href={basePath}>← Back to blog</a>
    </nav>
    <main>
      <BlogPostComponent post={post} basePath={basePath} />
    </main>
  </body>
</html>

<style is:global>
  [data-acms-page] {
    margin: 0;
    font-family: var(--acms-font-body, "Cormorant Garamond", "Garamond", "Georgia", serif);
    background: var(--acms-color-bg, #faf8f5);
    color: var(--acms-color-text, #3d3833);
    -webkit-font-smoothing: antialiased;
  }
  [data-acms-breadcrumb] {
    max-width: var(--acms-content-width, 40rem);
    margin-inline: auto;
    padding: var(--acms-space-unit, 1.25rem);
    padding-top: calc(var(--acms-space-unit, 1.25rem) * 1.5);
  }
  [data-acms-breadcrumb] a {
    color: var(--acms-color-text-muted, #9a9089);
    text-decoration: none;
    font-size: 0.8rem;
    font-family: var(--acms-font-mono, monospace);
    letter-spacing: 0.03em;
    transition: color 0.4s ease;
  }
  [data-acms-breadcrumb] a:hover {
    color: var(--acms-color-accent, #8b7355);
  }
</style>
